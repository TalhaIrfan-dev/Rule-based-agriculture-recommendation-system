<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>DARS â€” Digital Agriculture Recommender System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ¾</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== CSS Variables ====== */
        :root {
            /* Color Palette inspired by agriculture */
            --primary: #2E7D32;
            --primary-light: #4CAF50;
            --primary-dark: #1B5E20;
            --secondary: #FF9800;
            --secondary-light: #FFB74D;
            --accent: #2196F3;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --info: #2196F3;
            
            /* Neutral colors */
            --bg: #f8fdf8;
            --card: #ffffff;
            --sidebar: #1a3c2e;
            --text: #1a2c24;
            --text-light: #6b7c74;
            --border: #e0f2e0;
            --shadow: rgba(46, 125, 50, 0.08);
            --shadow-hover: rgba(46, 125, 50, 0.15);
            
            /* Typography */
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-heading: 'Montserrat', 'Segoe UI', sans-serif;
            
            /* Spacing */
            --radius: 12px;
            --radius-sm: 8px;
            --gap: 16px;
            --gap-sm: 8px;
            
            /* Transitions */
            --transition: all 0.3s ease;
        }
        
        /* ====== Base Styles ====== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100%;
            font-family: var(--font-main);
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8fdf8 0%, #e8f5e9 100%);
            min-height: 100vh;
        }
        
        /* ====== Login Page ====== */
        #login-page {
            width: 100%;
            max-width: 420px;
            margin: auto;
            padding: 40px 32px;
            border-radius: var(--radius);
            background: var(--card);
            box-shadow: 0 10px 40px rgba(46, 125, 50, 0.15);
            border: 1px solid var(--border);
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        .login-header {
            margin-bottom: 30px;
        }
        
        .login-header i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
            display: block;
        }
        
        .login-header h2 {
            color: var(--primary-dark);
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .login-header p {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .login-input {
            width: 100%;
            padding: 14px 16px;
            margin-bottom: 20px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            font-size: 15px;
            transition: var(--transition);
            background: #f9fffa;
        }
        
        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        .role-box {
            margin: 20px 0;
            padding: 20px;
            background: #f1f8f1;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            text-align: left;
        }
        
        .role-box label {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
            color: var(--text);
            font-weight: 500;
        }
        
        .role-box input[type="radio"] {
            margin-right: 10px;
            accent-color: var(--primary);
        }
        
        /* ====== Buttons ====== */
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 125, 50, 0.25);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.secondary {
            background: #f1f8f1;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .btn.secondary:hover {
            background: #e8f5e9;
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            box-shadow: none;
        }
        
        .btn-outline:hover {
            background: rgba(46, 125, 50, 0.05);
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        /* ====== Main App Container ====== */
        .app {
            width: 100%;
            max-width: 1200px;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: 0 15px 50px rgba(46, 125, 50, 0.15);
            overflow: hidden;
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 700px;
            height: 85vh;
            border: 1px solid var(--border);
            animation: slideIn 0.5s ease;
        }
        
        /* ====== Sidebar ====== */
        .sidebar {
            background: linear-gradient(180deg, var(--sidebar) 0%, #2d5a45 100%);
            color: white;
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .brand i {
            font-size: 1.8rem;
            color: #8bc34a;
        }
        
        .brand-text {
            font-weight: 700;
            font-size: 1.3rem;
            font-family: var(--font-heading);
        }
        
        .brand-sub {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: var(--radius-sm);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .user-details {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .user-role {
            font-size: 0.8rem;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .user-role i {
            font-size: 0.7rem;
        }
        
        .nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 25px;
            flex: 1;
        }
        
        .nav button {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            text-align: left;
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 15px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .nav button:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }
        
        .nav button.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            box-shadow: inset 3px 0 0 var(--primary-light);
        }
        
        .nav i {
            width: 20px;
            font-size: 1.1rem;
        }
        
        .sidebar-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
            opacity: 0.7;
        }
        
        /* ====== Main Content ====== */
        .main {
            padding: 25px 30px;
            background: var(--bg);
            overflow-y: auto;
        }
        
        header.top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        header h1 {
            font-size: 1.8rem;
            color: var(--primary-dark);
            font-family: var(--font-heading);
            font-weight: 700;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .notification-badge {
            position: relative;
            background: #f9fffa;
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .notification-badge:hover {
            background: #f1f8f1;
        }
        
        .notification-badge i {
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .notification-badge::after {
            content: '3';
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logout-btn {
            background: #f9fffa;
            border: 1px solid var(--border);
            color: var(--primary);
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logout-btn:hover {
            background: #f1f8f1;
        }
        
        /* ====== Cards ====== */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px var(--shadow);
            border: 1px solid var(--border);
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: 0 8px 25px var(--shadow-hover);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-header h3 {
            font-size: 1.3rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        /* ====== Grid Layout ====== */
        .grid {
            display: grid;
            gap: var(--gap);
        }
        
        .grid.cols-2 {
            grid-template-columns: 1fr 1fr;
        }
        
        .grid.cols-3 {
            grid-template-columns: 1fr 1fr 1fr;
        }
        
        /* ====== Form Elements ====== */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        label.required::after {
            content: " *";
            color: var(--danger);
        }
        
        input[type="text"], input[type="number"], input[type="email"], input[type="password"], select, textarea {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: #f9fffa;
            font-size: 15px;
            color: var(--text);
            transition: var(--transition);
            font-family: var(--font-main);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input[type="checkbox"] {
            accent-color: var(--primary);
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 16px;
            background: #f9fffa;
            border: 1px dashed var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-light);
        }
        
        .file-upload-label:hover {
            background: #f1f8f1;
            border-color: var(--primary);
        }
        
        /* ====== Tables ====== */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .table th {
            background: #f1f8f1;
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--primary-dark);
            border-bottom: 2px solid var(--border);
            font-size: 0.9rem;
        }
        
        .table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 0.95rem;
        }
        
        .table tr:hover {
            background: #f9fffa;
        }
        
        .table .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status.success {
            background: #e8f5e9;
            color: var(--success);
        }
        
        .status.warning {
            background: #fff3e0;
            color: var(--warning);
        }
        
        .status.danger {
            background: #ffebee;
            color: var(--danger);
        }
        
        /* ====== Stats Cards ====== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .stat-1 .stat-icon { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .stat-2 .stat-icon { background: linear-gradient(135deg, #2196F3, #0D47A1); }
        .stat-3 .stat-icon { background: linear-gradient(135deg, #FF9800, #E65100); }
        .stat-4 .stat-icon { background: linear-gradient(135deg, #9C27B0, #4A148C); }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        /* ====== Alerts & Notifications ====== */
        .alert {
            padding: 15px 20px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert-success {
            background: #e8f5e9;
            border-left: 4px solid var(--success);
            color: #1b5e20;
        }
        
        .alert-warning {
            background: #fff3e0;
            border-left: 4px solid var(--warning);
            color: #e65100;
        }
        
        .alert-info {
            background: #e3f2fd;
            border-left: 4px solid var(--info);
            color: #0d47a1;
        }
        
        /* ====== Dashboard Elements ====== */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 20px 15px;
            background: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow);
            border-color: var(--primary);
        }
        
        .quick-action-btn i {
            font-size: 2rem;
            color: var(--primary);
        }
        
        .quick-action-btn span {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.9rem;
        }
        
        /* ====== Crop Recommendation Results ====== */
        .crop-recommendation {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .crop-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .crop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow);
        }
        
        .crop-rank {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .crop-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }
        
        .crop-match {
            display: inline-block;
            padding: 5px 12px;
            background: #e8f5e9;
            color: var(--success);
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 15px;
        }
        
        .crop-details {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }
        
        .crop-actions {
            display: flex;
            gap: 8px;
        }
        
        /* ====== Loading States ====== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: var(--text-light);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f1f8f1;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        /* ====== Footer ====== */
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-light);
            font-size: 0.85rem;
        }
        
        /* ====== Animations ====== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ====== Responsive Design ====== */
        @media (max-width: 1024px) {
            .app {
                grid-template-columns: 1fr;
                height: 90vh;
            }
            
            .sidebar {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
                background: #f1f8f1;
                border-radius: var(--radius-sm);
                cursor: pointer;
            }
            
            .mobile-menu-toggle i {
                font-size: 1.2rem;
                color: var(--primary);
            }
        }
        
        @media (max-width: 768px) {
            .grid.cols-2, .grid.cols-3 {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .crop-recommendation {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                justify-content: center;
            }
            
            .quick-action-btn {
                min-width: calc(50% - 10px);
            }
            
            header.top {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .app {
                height: 95vh;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-action-btn {
                min-width: 100%;
            }
            
            .card {
                padding: 20px 15px;
            }
            
            .main {
                padding: 20px 15px;
            }
        }
        
        /* ====== Utility Classes ====== */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mb-0 {
            margin-bottom: 0;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mt-30 {
            margin-top: 30px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .p-20 {
            padding: 20px;
        }
        
        .flex {
            display: flex;
        }
        
        .flex-column {
            flex-direction: column;
        }
        
        .align-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .justify-center {
            justify-content: center;
        }
        
        .gap-10 {
            gap: 10px;
        }
        
        .gap-20 {
            gap: 20px;
        }
        
        .w-100 {
            width: 100%;
        }
    </style>
</head>
<body>

<!-- ======================= -->
<!--         LOGIN PAGE      -->
<!-- ======================= -->
<div id="login-page">
    <div class="login-header">
        <i class="fas fa-seedling"></i>
        <h2>Digital Agriculture Recommender</h2>
        <p>Access rule-based agricultural recommendations</p>
    </div>
    
    <input id="login-name" class="login-input" placeholder="Enter your full name" required>
    
    <div class="role-box">
        <p style="margin-bottom: 15px; font-weight: 600;">Select your role:</p>
        <label>
            <input type="radio" name="role" value="Farmer" checked> 
            <i class="fas fa-user" style="margin-right: 8px;"></i>
            Farmer
        </label>
        <label>
            <input type="radio" name="role" value="Admin"> 
            <i class="fas fa-user-cog" style="margin-right: 8px;"></i>
            Administrator
        </label>
        <label>
            <input type="radio" name="role" value="Agronomist"> 
            <i class="fas fa-user-md" style="margin-right: 8px;"></i>
            Agronomist
        </label>
    </div>
    
    <button class="btn w-100" onclick="login()">
        <i class="fas fa-sign-in-alt"></i>
        Login to DARS
    </button>
    
    <div class="mt-20" style="font-size: 0.85rem; color: var(--text-light);">
        <p>Demo: Enter any name and select a role to explore the system</p>
    </div>
</div>

<!-- ======================= -->
<!--       MAIN APP          -->
<!-- ======================= -->
<div id="app-container" class="app hidden" role="application" aria-label="Digital Agriculture Recommender System">
    <!-- SIDEBAR -->
    <aside class="sidebar" aria-hidden="false">
        <div class="brand">
            <i class="fas fa-tractor"></i>
            <div>
                <div class="brand-text">DARS</div>
                <div class="brand-sub">Digital Agriculture Recommender</div>
            </div>
        </div>
        
        <div class="user-info">
            <div class="user-avatar" id="user-avatar">U</div>
            <div class="user-details">
                <div class="user-name" id="user-name">User</div>
                <div class="user-role">
                    <i class="fas fa-circle" style="font-size: 0.5rem;"></i>
                    <span id="user-role">Farmer</span>
                </div>
            </div>
        </div>
        
        <nav class="nav" aria-label="Main navigation">
            <button id="nav-dashboard" class="active" onclick="show('dashboard')">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </button>
            <button id="nav-recommend" onclick="show('recommendForm')">
                <i class="fas fa-leaf"></i>
                <span>Crop Recommendation</span>
            </button>
            <button id="nav-soil" onclick="show('soilForm')">
                <i class="fas fa-mountain"></i>
                <span>Soil Suitability</span>
            </button>
            <button id="nav-disease" onclick="show('disease')">
                <i class="fas fa-bug"></i>
                <span>Disease Diagnosis</span>
            </button>
            <button id="nav-forecast" onclick="show('forecast')">
                <i class="fas fa-chart-line"></i>
                <span>Demand Forecast</span>
            </button>
            <button id="nav-history" onclick="show('history')">
                <i class="fas fa-history"></i>
                <span>Recommendation History</span>
            </button>
            <button id="nav-admin" onclick="show('admin')" title="Admin screens">
                <i class="fas fa-cogs"></i>
                <span>Admin Panel</span>
            </button>
            <button id="nav-reports" onclick="show('reports')">
                <i class="fas fa-chart-bar"></i>
                <span>Reports & Analytics</span>
            </button>
        </nav>
        
        <div class="sidebar-footer">
            <p>Sukkur IBA University</p>
            <p>Department of Computer Science</p>
            <p>Software Engineering Project</p>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
        <header class="top">
            <div>
                <h1 id="screen-title">Dashboard</h1>
                <p id="screen-subtitle" style="color: var(--text-light); font-size: 0.95rem;">Welcome to DARS - Your agricultural decision support system</p>
            </div>
            
            <div class="header-actions">
                <div class="notification-badge">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Screen -->
        <section id="dashboard" class="card" role="region" aria-label="Dashboard">
            <div class="card-header">
                <h3>Farm Management Dashboard</h3>
                <div class="card-icon">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card stat-1">
                    <div class="stat-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="stat-recommendations">5</div>
                        <div class="stat-label">Crop Recommendations</div>
                    </div>
                </div>
                
                <div class="stat-card stat-2">
                    <div class="stat-icon">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="stat-soil-checks">3</div>
                        <div class="stat-label">Soil Analyses</div>
                    </div>
                </div>
                
                <div class="stat-card stat-3">
                    <div class="stat-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="stat-disease-checks">2</div>
                        <div class="stat-label">Disease Diagnoses</div>
                    </div>
                </div>
                
                <div class="stat-card stat-4">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="stat-forecasts">4</div>
                        <div class="stat-label">Demand Forecasts</div>
                    </div>
                </div>
            </div>
            
            <h3 class="mb-20">Quick Actions</h3>
            <div class="quick-actions">
                <div class="quick-action-btn" onclick="show('recommendForm')">
                    <i class="fas fa-leaf"></i>
                    <span>Get Crop Recommendation</span>
                </div>
                
                <div class="quick-action-btn" onclick="show('soilForm')">
                    <i class="fas fa-mountain"></i>
                    <span>Check Soil Suitability</span>
                </div>
                
                <div class="quick-action-btn" onclick="show('disease')">
                    <i class="fas fa-bug"></i>
                    <span>Diagnose Disease</span>
                </div>
                
                <div class="quick-action-btn" onclick="show('forecast')">
                    <i class="fas fa-chart-line"></i>
                    <span>Demand Forecast</span>
                </div>
                
                <div class="quick-action-btn" onclick="show('history')">
                    <i class="fas fa-history"></i>
                    <span>View History</span>
                </div>
                
                <div class="quick-action-btn" onclick="show('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </div>
            </div>
            
            <div class="grid cols-2 mt-30">
                <div>
                    <h3 class="mb-20">Recent Recommendations</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Crop</th>
                                <th>Date</th>
                                <th>Match</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recent-list">
                            <tr>
                                <td>Wheat</td>
                                <td>2025-10-14</td>
                                <td><span class="status success">88%</span></td>
                                <td>Applied</td>
                            </tr>
                            <tr>
                                <td>Mustard</td>
                                <td>2025-09-21</td>
                                <td><span class="status warning">76%</span></td>
                                <td>Considered</td>
                            </tr>
                            <tr>
                                <td>Cotton</td>
                                <td>2025-09-05</td>
                                <td><span class="status success">92%</span></td>
                                <td>Planted</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div>
                    <h3 class="mb-20">System Alerts & Tips</h3>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>High disease risk</strong> for Wheat in your zone. Consider preventive measures.
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Soil pH slightly acidic</strong> â€” lime recommended for optimal crop growth.
                        </div>
                    </div>
                    
                    <div class="alert alert-success">
                        <i class="fas fa-chart-line"></i>
                        <div>
                            <strong>Wheat market demand</strong> expected to rise 15% next season.
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-cloud-sun"></i>
                        <div>
                            <strong>Seasonal advisory:</strong> Rabi season planting window opens in 2 weeks.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recommendation Form -->
        <section id="recommendForm" class="card hidden" role="region" aria-label="Recommendation Form">
            <div class="card-header">
                <h3>Crop Recommendation</h3>
                <div class="card-icon">
                    <i class="fas fa-leaf"></i>
                </div>
            </div>
            
            <p class="mb-20" style="color: var(--text-light);">Get personalized crop recommendations based on your soil, season, and region using our rule-based inference engine.</p>
            
            <form id="rec-form" onsubmit="handleRecommend(event)">
                <div class="grid cols-2">
                    <div class="form-group">
                        <label for="region" class="required">Region</label>
                        <select id="region" required>
                            <option value="">Select Region</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Sindh">Sindh</option>
                            <option value="Balochistan">Balochistan</option>
                            <option value="Khyber Pakhtunkhwa">Khyber Pakhtunkhwa</option>
                            <option value="Gilgit-Baltistan">Gilgit-Baltistan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="season" class="required">Season</label>
                        <select id="season" required>
                            <option value="">Select Season</option>
                            <option value="Rabi">Rabi (Winter)</option>
                            <option value="Kharif">Kharif (Monsoon)</option>
                            <option value="Zaid">Zaid (Summer)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="soilType" class="required">Soil Type</label>
                        <select id="soilType" required>
                            <option value="">Select Soil Type</option>
                            <option value="Loamy">Loamy</option>
                            <option value="Clay">Clay</option>
                            <option value="Sandy">Sandy</option>
                            <option value="Peaty">Peaty</option>
                            <option value="Silty">Silty</option>
                            <option value="Chalky">Chalky</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="landArea" class="required">Land Area (acres)</label>
                        <input id="landArea" type="number" min="0.1" step="0.1" placeholder="e.g., 5.5" required>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="ph">Soil pH Level (Optional)</label>
                        <input id="ph" type="number" min="3" max="10" step="0.1" placeholder="e.g., 6.5">
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="notes">Special Notes / Additional Parameters</label>
                        <textarea id="notes" placeholder="Irrigation type, previous crop, fertilizer used, etc."></textarea>
                    </div>
                </div>

                <div style="margin-top: 25px" class="flex align-center justify-between">
                    <div>
                        <button class="btn" type="submit">
                            <i class="fas fa-search"></i>
                            Get Recommendation
                        </button>
                        <button type="button" class="btn secondary" onclick="show('dashboard')">
                            <i class="fas fa-arrow-left"></i>
                            Back to Dashboard
                        </button>
                    </div>
                    
                    <div id="rec-loading" class="hidden">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>Processing recommendation...</div>
                        </div>
                    </div>
                </div>
            </form>

            <div id="rec-result" class="card hidden mt-20">
                <div class="card-header">
                    <h3>Recommended Crops</h3>
                    <div class="card-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                
                <div id="rec-list" class="crop-recommendation"></div>
                
                <div class="alert alert-info mt-20">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Disclaimer:</strong> These recommendations are based on rule-based inference. Always consult with certified agronomists before making final decisions. The system provider is not liable for crop loss or damages.
                    </div>
                </div>
                
                <div class="flex align-center justify-between mt-20">
                    <div>
                        <button class="btn" onclick="downloadRec()">
                            <i class="fas fa-download"></i>
                            Download Recommendation
                        </button>
                        <button class="btn secondary" onclick="saveRecommendation()">
                            <i class="fas fa-save"></i>
                            Save to History
                        </button>
                    </div>
                    <button class="btn-outline" onclick="show('recommendForm')">
                        <i class="fas fa-redo"></i>
                        New Request
                    </button>
                </div>
            </div>
        </section>

        <!-- Soil Form -->
        <section id="soilForm" class="card hidden" aria-label="Soil Form">
            <div class="card-header">
                <h3>Soilâ€“Crop Suitability Analysis</h3>
                <div class="card-icon">
                    <i class="fas fa-mountain"></i>
                </div>
            </div>
            
            <p class="mb-20" style="color: var(--text-light);">Check which crops are suitable for your soil type and conditions based on our soil-crop compatibility database.</p>
            
            <form id="soil-form" onsubmit="handleSoil(event)">
                <div class="grid cols-2">
                    <div class="form-group">
                        <label for="soilType2" class="required">Soil Type</label>
                        <select id="soilType2" required>
                            <option value="">Select Soil Type</option>
                            <option value="Loamy">Loamy</option>
                            <option value="Clay">Clay</option>
                            <option value="Sandy">Sandy</option>
                            <option value="Peaty">Peaty</option>
                            <option value="Silty">Silty</option>
                            <option value="Chalky">Chalky</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ph2">pH Level</label>
                        <input id="ph2" type="number" step="0.1" min="3" max="10" placeholder="e.g., 6.8">
                    </div>
                    
                    <div class="form-group">
                        <label for="n">Nitrogen (N) ppm</label>
                        <input id="n" type="number" placeholder="e.g., 20">
                    </div>
                    
                    <div class="form-group">
                        <label for="p">Phosphorus (P) ppm</label>
                        <input id="p" type="number" placeholder="e.g., 15">
                    </div>
                    
                    <div class="form-group">
                        <label for="k">Potassium (K) ppm</label>
                        <input id="k" type="number" placeholder="e.g., 180">
                    </div>
                    
                    <div class="form-group">
                        <label for="moisture">Moisture Content (%)</label>
                        <input id="moisture" type="number" min="0" max="100" placeholder="e.g., 25">
                    </div>
                </div>
                
                <div style="margin-top: 25px" class="flex align-center gap-20">
                    <button class="btn" type="submit">
                        <i class="fas fa-flask"></i>
                        Analyze Soil Suitability
                    </button>
                    <button type="button" class="btn secondary" onclick="show('dashboard')">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </button>
                </div>
            </form>

            <div id="soil-result" class="card hidden mt-20">
                <div class="card-header">
                    <h3>Suitable Crops for Your Soil</h3>
                    <div class="card-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                
                <div id="suitable-list" class="crop-recommendation"></div>
                
                <div class="mt-20">
                    <h4>Soil Improvement Recommendations</h4>
                    <div id="soil-advice" class="alert alert-info">
                        <i class="fas fa-lightbulb"></i>
                        <div>Based on your soil parameters, we recommend adding organic compost to improve soil structure and fertility.</div>
                    </div>
                </div>
                
                <div class="flex align-center justify-between mt-20">
                    <button class="btn" onclick="show('recommendForm')">
                        <i class="fas fa-leaf"></i>
                        Get Crop Recommendation
                    </button>
                    <button class="btn-outline" onclick="show('soilForm')">
                        <i class="fas fa-redo"></i>
                        New Soil Analysis
                    </button>
                </div>
            </div>
        </section>

        <!-- Disease Screen -->
        <section id="disease" class="card hidden" aria-label="Disease Diagnosis">
            <div class="card-header">
                <h3>Crop Disease Diagnosis</h3>
                <div class="card-icon">
                    <i class="fas fa-bug"></i>
                </div>
            </div>
            
            <p class="mb-20" style="color: var(--text-light);">Identify crop diseases based on symptoms and get treatment recommendations from our agricultural knowledge base.</p>
            
            <form id="disease-form" onsubmit="handleDisease(event)">
                <div class="grid cols-2">
                    <div class="form-group">
                        <label for="dCrop" class="required">Select Crop</label>
                        <select id="dCrop" required>
                            <option value="">Select Crop</option>
                            <option value="Wheat">Wheat</option>
                            <option value="Rice">Rice</option>
                            <option value="Mustard">Mustard</option>
                            <option value="Cotton">Cotton</option>
                            <option value="Maize">Maize</option>
                            <option value="Sugarcane">Sugarcane</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="required">Observed Symptoms</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" name="sym" value="yellow" id="sym-yellow">
                                <label for="sym-yellow">Yellowing leaves</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="sym" value="brown" id="sym-brown">
                                <label for="sym-brown">Brown spots</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="sym" value="wilting" id="sym-wilting">
                                <label for="sym-wilting">Wilting</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="sym" value="powder" id="sym-powder">
                                <label for="sym-powder">White powder</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="sym" value="spots" id="sym-spots">
                                <label for="sym-spots">Black spots</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="sym" value="stunted" id="sym-stunted">
                                <label for="sym-stunted">Stunted growth</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="symptom-desc">Additional Symptom Description</label>
                        <textarea id="symptom-desc" placeholder="Describe other symptoms, affected area, progression, etc."></textarea>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="photo">Upload Photo of Affected Crop (Optional)</label>
                        <div class="file-upload">
                            <input id="photo" type="file" accept="image/*">
                            <label class="file-upload-label" for="photo">
                                <i class="fas fa-camera"></i>
                                <span>Choose file or drag & drop</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 25px" class="flex align-center gap-20">
                    <button class="btn" type="submit">
                        <i class="fas fa-stethoscope"></i>
                        Diagnose Disease
                    </button>
                    <button type="button" class="btn secondary" onclick="show('dashboard')">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </button>
                </div>
            </form>

            <div id="disease-result" class="card hidden mt-20">
                <div class="card-header">
                    <h3>Diagnosis Results</h3>
                    <div class="card-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                </div>
                
                <div id="diseaseres"></div>
                
                <div class="alert alert-warning mt-20">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Safety Note:</strong> Always follow recommended safety guidelines when applying treatments. Use protective equipment and follow local agricultural regulations.
                    </div>
                </div>
                
                <div class="mt-20">
                    <button class="btn" onclick="show('disease')">
                        <i class="fas fa-redo"></i>
                        New Diagnosis
                    </button>
                </div>
            </div>
        </section>

        <!-- Forecast -->
        <section id="forecast" class="card hidden" aria-label="Demand Forecast">
            <div class="card-header">
                <h3>Seasonal Demand Forecast</h3>
                <div class="card-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            
            <p class="mb-20" style="color: var(--text-light);">Get market demand predictions for upcoming seasons based on historical data and seasonal trends.</p>
            
            <form id="forecast-form" onsubmit="handleForecast(event)">
                <div class="grid cols-2">
                    <div class="form-group">
                        <label for="fSeason" class="required">Season</label>
                        <select id="fSeason" required>
                            <option value="">Select Season</option>
                            <option value="Rabi">Rabi (Winter)</option>
                            <option value="Kharif">Kharif (Monsoon)</option>
                            <option value="Zaid">Zaid (Summer)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="fRegion" class="required">Region</label>
                        <select id="fRegion" required>
                            <option value="">Select Region</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Sindh">Sindh</option>
                            <option value="Balochistan">Balochistan</option>
                            <option value="Khyber Pakhtunkhwa">Khyber Pakhtunkhwa</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="fYear">Year</label>
                        <select id="fYear">
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 25px" class="flex align-center gap-20">
                    <button class="btn" type="submit">
                        <i class="fas fa-chart-bar"></i>
                        Generate Forecast
                    </button>
                    <button type="button" class="btn secondary" onclick="show('dashboard')">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </button>
                </div>
            </form>

            <div id="forecast-result" class="card hidden mt-20">
                <div class="card-header">
                    <h3>Demand Forecast Results</h3>
                    <div class="card-icon">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                </div>
                
                <table class="table" id="forecast-table">
                    <thead>
                        <tr>
                            <th>Crop</th>
                            <th>Demand Forecast</th>
                            <th>Trend</th>
                            <th>Price Projection</th>
                            <th>Recommendation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
                
                <div class="flex align-center justify-between mt-20">
                    <button class="btn" onclick="show('recommendForm')">
                        <i class="fas fa-leaf"></i>
                        Get Crop Recommendations
                    </button>
                    <button class="btn-outline" onclick="show('forecast')">
                        <i class="fas fa-redo"></i>
                        New Forecast
                    </button>
                </div>
            </div>
        </section>

        <!-- Recommendation History -->
        <section id="history" class="card hidden" aria-label="Recommendation History">
            <div class="card-header">
                <h3>Recommendation History</h3>
                <div class="card-icon">
                    <i class="fas fa-history"></i>
                </div>
            </div>
            
            <p class="mb-20" style="color: var(--text-light);">View your past crop recommendations, soil analyses, disease diagnoses, and demand forecasts.</p>
            
            <div class="flex align-center gap-20 mb-20">
                <button class="btn-small active" onclick="filterHistory('all')">All</button>
                <button class="btn-small btn-outline" onclick="filterHistory('crop')">Crop Recs</button>
                <button class="btn-small btn-outline" onclick="filterHistory('soil')">Soil Analysis</button>
                <button class="btn-small btn-outline" onclick="filterHistory('disease')">Disease</button>
                <button class="btn-small btn-outline" onclick="filterHistory('forecast')">Forecasts</button>
            </div>
            
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Details</th>
                        <th>Result</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="history-table">
                    <tr>
                        <td>2025-10-14</td>
                        <td><span class="status success">Crop Rec</span></td>
                        <td>Wheat for Rabi season, Loamy soil</td>
                        <td>88% match</td>
                        <td>
                            <button class="btn-small btn-outline" onclick="viewHistoryItem(1)">View</button>
                            <button class="btn-small" onclick="downloadHistoryItem(1)">Download</button>
                        </td>
                    </tr>
                    <tr>
                        <td>2025-09-21</td>
                        <td><span class="status warning">Soil Analysis</span></td>
                        <td>Loamy soil, pH 6.8</td>
                        <td>Suitable for Wheat, Mustard</td>
                        <td>
                            <button class="btn-small btn-outline" onclick="viewHistoryItem(2)">View</button>
                            <button class="btn-small" onclick="downloadHistoryItem(2)">Download</button>
                        </td>
                    </tr>
                    <tr>
                        <td>2025-09-05</td>
                        <td><span class="status danger">Disease</span></td>
                        <td>Wheat, Yellow leaves, Brown spots</td>
                        <td>Yellow Rust identified</td>
                        <td>
                            <button class="btn-small btn-outline" onclick="viewHistoryItem(3)">View</button>
                            <button class="btn-small" onclick="downloadHistoryItem(3)">Download</button>
                        </td>
                    </tr>
                    <tr>
                        <td>2025-08-18</td>
                        <td><span class="status info">Forecast</span></td>
                        <td>Kharif season, Punjab region</td>
                        <td>Rice demand High</td>
                        <td>
                            <button class="btn-small btn-outline" onclick="viewHistoryItem(4)">View</button>
                            <button class="btn-small" onclick="downloadHistoryItem(4)">Download</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div class="flex align-center justify-between mt-20">
                <div>
                    <button class="btn" onclick="exportAllHistory()">
                        <i class="fas fa-file-export"></i>
                        Export All History
                    </button>
                </div>
                <button class="btn secondary" onclick="show('dashboard')">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </button>
            </div>
        </section>

        <!-- Reports & Analytics -->
        <section id="reports" class="card hidden" aria-label="Reports & Analytics">
            <div class="card-header">
                <h3>Reports & Analytics</h3>
                <div class="card-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
            </div>
            
            <p class="mb-20" style="color: var(--text-light);">Generate analytical reports and visualizations based on your agricultural data and system usage.</p>
            
            <div class="grid cols-3">
                <div class="card">
                    <div class="card-icon" style="background: linear-gradient(135deg, #4CAF50, #2E7D32);">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h4 class="mt-20">Crop Recommendation Report</h4>
                    <p style="color: var(--text-light); font-size: 0.9rem; margin: 10px 0;">Generate a detailed report of all crop recommendations with success metrics.</p>
                    <button class="btn w-100 mt-20" onclick="generateReport('crop')">
                        <i class="fas fa-file-alt"></i>
                        Generate Report
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-icon" style="background: linear-gradient(135deg, #2196F3, #0D47A1);">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <h4 class="mt-20">Soil Analysis Summary</h4>
                    <p style="color: var(--text-light); font-size: 0.9rem; margin: 10px 0;">View comprehensive soil analysis results and improvement recommendations.</p>
                    <button class="btn w-100 mt-20" onclick="generateReport('soil')">
                        <i class="fas fa-file-alt"></i>
                        Generate Report
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-icon" style="background: linear-gradient(135deg, #FF9800, #E65100);">
                        <i class="fas fa-bug"></i>
                    </div>
                    <h4 class="mt-20">Disease Diagnosis Report</h4>
                    <p style="color: var(--text-light); font-size: 0.9rem; margin: 10px 0;">Analyze disease patterns and treatment effectiveness over time.</p>
                    <button class="btn w-100 mt-20" onclick="generateReport('disease')">
                        <i class="fas fa-file-alt"></i>
                        Generate Report
                    </button>
                </div>
            </div>
            
            <div class="mt-30">
                <h3>System Usage Statistics</h3>
                <div class="grid cols-2 mt-20">
                    <div>
                        <h4>Feature Usage</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Feature</th>
                                    <th>Usage Count</th>
                                    <th>Last Used</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Crop Recommendation</td>
                                    <td>12</td>
                                    <td>2025-10-14</td>
                                </tr>
                                <tr>
                                    <td>Soil Analysis</td>
                                    <td>8</td>
                                    <td>2025-09-21</td>
                                </tr>
                                <tr>
                                    <td>Disease Diagnosis</td>
                                    <td>5</td>
                                    <td>2025-09-05</td>
                                </tr>
                                <tr>
                                    <td>Demand Forecast</td>
                                    <td>7</td>
                                    <td>2025-08-18</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div>
                        <h4>Recommendation Success Rate</h4>
                        <div style="background: #f1f8f1; border-radius: var(--radius); padding: 20px; height: 100%; display: flex; flex-direction: column; justify-content: center;">
                            <div style="text-align: center;">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--primary);">86%</div>
                                <div style="color: var(--text-light);">Average recommendation accuracy</div>
                            </div>
                            <div style="margin-top: 20px;">
                                <div class="flex align-center justify-between">
                                    <span>Applied recommendations</span>
                                    <span class="status success">75%</span>
                                </div>
                                <div class="flex align-center justify-between mt-10">
                                    <span>Positive outcomes</span>
                                    <span class="status success">68%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex align-center justify-between mt-30">
                <button class="btn" onclick="generateComprehensiveReport()">
                    <i class="fas fa-file-pdf"></i>
                    Generate Comprehensive Report
                </button>
                <button class="btn secondary" onclick="show('dashboard')">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </button>
            </div>
        </section>

        <!-- ADMIN PANEL -->
        <section id="admin" class="card hidden" aria-label="Admin Panel">
            <div class="card-header">
                <h3>Administration Panel</h3>
                <div class="card-icon">
                    <i class="fas fa-user-cog"></i>
                </div>
            </div>
            
            <p class="mb-20" style="color: var(--text-light);">Manage system datasets, rules, users, and monitor system performance.</p>
            
            <div class="alert alert-info mb-20">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong>Admin Access Only:</strong> You have full access to manage all system components. Changes made here affect all users.
                </div>
            </div>
            
            <div style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:25px">
                <button class="btn" onclick="showAdminTab('crops')">
                    <i class="fas fa-leaf"></i>
                    Manage Crops
                </button>
                <button class="btn" onclick="showAdminTab('rules')">
                    <i class="fas fa-cogs"></i>
                    Edit Rules
                </button>
                <button class="btn" onclick="showAdminTab('users')">
                    <i class="fas fa-users"></i>
                    User Management
                </button>
                <button class="btn" onclick="showAdminTab('datasets')">
                    <i class="fas fa-database"></i>
                    Datasets
                </button>
                <button class="btn" onclick="showAdminTab('system')">
                    <i class="fas fa-chart-line"></i>
                    System Monitoring
                </button>
            </div>

            <!-- Crop Management -->
            <div id="admin-crops">
                <div class="card-header">
                    <h3>Crop Management</h3>
                    <div class="card-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                </div>
                
                <form id="crop-form" onsubmit="handleCropSave(event)">
                    <div class="grid cols-2">
                        <div class="form-group">
                            <label for="crop-name" class="required">Crop Name</label>
                            <input id="crop-name" placeholder="e.g., Wheat" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="crop-soil">Suitable Soil Types</label>
                            <input id="crop-soil" placeholder="e.g., Loamy, Clay">
                        </div>
                        
                        <div class="form-group">
                            <label for="crop-season">Suitable Seasons</label>
                            <input id="crop-season" placeholder="e.g., Rabi, Kharif">
                        </div>
                        
                        <div class="form-group">
                            <label for="crop-nut">Nutrient Requirements</label>
                            <input id="crop-nut" placeholder="e.g., High Nitrogen">
                        </div>
                        
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="crop-desc">Crop Description</label>
                            <textarea id="crop-desc" placeholder="Description, growth period, water requirements, etc."></textarea>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px" class="flex align-center gap-20">
                        <button class="btn" type="submit">
                            <i class="fas fa-save"></i>
                            Save Crop
                        </button>
                        <button type="button" class="btn secondary" onclick="resetCropForm()">
                            <i class="fas fa-undo"></i>
                            Reset Form
                        </button>
                    </div>
                </form>

                <h4 class="mt-30 mb-20">Existing Crops</h4>
                <table class="table" id="crop-table">
                    <thead>
                        <tr>
                            <th>Crop Name</th>
                            <th>Soil Types</th>
                            <th>Seasons</th>
                            <th>Nutrient Needs</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Wheat</td>
                            <td>Loamy, Clay</td>
                            <td>Rabi</td>
                            <td>Medium Nitrogen</td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editCrop(1)">Edit</button>
                                <button class="btn-small" onclick="deleteCrop(1)">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Rice</td>
                            <td>Clay, Loamy</td>
                            <td>Kharif</td>
                            <td>High Nitrogen</td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editCrop(2)">Edit</button>
                                <button class="btn-small" onclick="deleteCrop(2)">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Mustard</td>
                            <td>Loamy, Sandy</td>
                            <td>Rabi</td>
                            <td>Low Nitrogen</td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editCrop(3)">Edit</button>
                                <button class="btn-small" onclick="deleteCrop(3)">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Cotton</td>
                            <td>Sandy, Loamy</td>
                            <td>Kharif</td>
                            <td>Medium Potassium</td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editCrop(4)">Edit</button>
                                <button class="btn-small" onclick="deleteCrop(4)">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Rule Management -->
            <div id="admin-rules" class="card hidden mt-20">
                <div class="card-header">
                    <h3>Rule Base Management</h3>
                    <div class="card-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                </div>
                
                <p class="mb-20" style="color: var(--text-light);">Edit the rule-based inference logic that powers the recommendation engine.</p>
                
                <form id="rule-form" onsubmit="handleRuleSave(event)">
                    <div class="form-group">
                        <label for="rule-category">Rule Category</label>
                        <select id="rule-category">
                            <option value="crop">Crop Recommendation</option>
                            <option value="soil">Soil Suitability</option>
                            <option value="disease">Disease Diagnosis</option>
                            <option value="demand">Demand Forecasting</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="rule-name">Rule Name / Identifier</label>
                        <input id="rule-name" placeholder="e.g., Wheat_Rabi_Loamy">
                    </div>
                    
                    <div class="grid cols-2">
                        <div class="form-group">
                            <label for="rule-condition">Condition (IF)</label>
                            <textarea id="rule-condition" placeholder="e.g., SoilType='Loamy' AND Season='Rabi'"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="rule-action">Action (THEN)</label>
                            <textarea id="rule-action" placeholder="e.g., Recommend='Wheat'"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rule-priority">Priority (1-10, higher = more important)</label>
                        <input id="rule-priority" type="number" min="1" max="10" value="5">
                    </div>
                    
                    <div style="margin-top:20px" class="flex align-center gap-20">
                        <button class="btn" type="submit">
                            <i class="fas fa-save"></i>
                            Save Rule
                        </button>
                        <button type="button" class="btn secondary" onclick="resetRuleForm()">
                            <i class="fas fa-undo"></i>
                            Reset Form
                        </button>
                        <button type="button" class="btn" onclick="testRule()">
                            <i class="fas fa-vial"></i>
                            Test Rule
                        </button>
                    </div>
                </form>

                <h4 class="mt-30 mb-20">Active Rules</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Rule Name</th>
                            <th>Condition</th>
                            <th>Action</th>
                            <th>Priority</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="rule-list">
                        <tr>
                            <td>Crop</td>
                            <td>Wheat_Rabi_Loamy</td>
                            <td>SoilType='Loamy' AND Season='Rabi'</td>
                            <td>Recommend='Wheat'</td>
                            <td>8</td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editRule(1)">Edit</button>
                                <button class="btn-small" onclick="deleteRule(1)">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Soil</td>
                            <td>Wheat_Soil_pH</td>
                            <td>pH >= 6.0 AND pH <= 7.5</td>
                            <td>SuitableFor='Wheat'</td>
                            <td>7</td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editRule(2)">Edit</button>
                                <button class="btn-small" onclick="deleteRule(2)">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Disease</td>
                            <td>Wheat_Yellow_Rust</td>
                            <td>Crop='Wheat' AND Symptom='Yellow leaves' AND Symptom='Brown spots'</td>
                            <td>Diagnose='Yellow Rust'</td>
                            <td>9</td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editRule(3)">Edit</button>
                                <button class="btn-small" onclick="deleteRule(3)">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- User Management -->
            <div id="admin-users" class="card hidden mt-20">
                <div class="card-header">
                    <h3>User Management</h3>
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                
                <p class="mb-20" style="color: var(--text-light);">Manage user accounts, roles, and permissions.</p>
                
                <div class="flex align-center justify-between mb-20">
                    <h4>Registered Users</h4>
                    <button class="btn" onclick="addNewUser()">
                        <i class="fas fa-user-plus"></i>
                        Add New User
                    </button>
                </div>
                
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Last Login</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ali Khan</td>
                            <td>ali.khan@example.com</td>
                            <td><span class="status success">Farmer</span></td>
                            <td>Today</td>
                            <td><span class="status success">Active</span></td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editUser(1)">Edit</button>
                                <button class="btn-small" onclick="toggleUserStatus(1)">Deactivate</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Admin User</td>
                            <td>admin@dars.com</td>
                            <td><span class="status warning">Admin</span></td>
                            <td>Yesterday</td>
                            <td><span class="status success">Active</span></td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editUser(2)">Edit</button>
                                <button class="btn-small" onclick="toggleUserStatus(2)">Deactivate</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Dr. Ahmed</td>
                            <td>ahmed.agro@example.com</td>
                            <td><span class="status info">Agronomist</span></td>
                            <td>3 days ago</td>
                            <td><span class="status success">Active</span></td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editUser(3)">Edit</button>
                                <button class="btn-small" onclick="toggleUserStatus(3)">Deactivate</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Test Farmer</td>
                            <td>test.farmer@example.com</td>
                            <td><span class="status success">Farmer</span></td>
                            <td>1 week ago</td>
                            <td><span class="status danger">Inactive</span></td>
                            <td>
                                <button class="btn-small btn-outline" onclick="editUser(4)">Edit</button>
                                <button class="btn-small" onclick="toggleUserStatus(4)">Activate</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Dataset Management -->
            <div id="admin-datasets" class="card hidden mt-20">
                <div class="card-header">
                    <h3>Dataset Management</h3>
                    <div class="card-icon">
                        <i class="fas fa-database"></i>
                    </div>
                </div>
                
                <p class="mb-20" style="color: var(--text-light);">Manage agricultural datasets including crops, soils, diseases, and market data.</p>
                
                <div class="grid cols-2">
                    <div class="card">
                        <h4>Crop Dataset</h4>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin: 10px 0;">Manage crop information, requirements, and suitability data.</p>
                        <div class="flex align-center justify-between mt-20">
                            <span>Records: 42</span>
                            <button class="btn-small" onclick="manageDataset('crops')">
                                <i class="fas fa-edit"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>Soil Dataset</h4>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin: 10px 0;">Manage soil types, properties, and compatibility data.</p>
                        <div class="flex align-center justify-between mt-20">
                            <span>Records: 18</span>
                            <button class="btn-small" onclick="manageDataset('soils')">
                                <i class="fas fa-edit"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>Disease Dataset</h4>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin: 10px 0;">Manage disease information, symptoms, and treatments.</p>
                        <div class="flex align-center justify-between mt-20">
                            <span>Records: 56</span>
                            <button class="btn-small" onclick="manageDataset('diseases')">
                                <i class="fas fa-edit"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>Market Data</h4>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin: 10px 0;">Manage historical demand and pricing data for forecasting.</p>
                        <div class="flex align-center justify-between mt-20">
                            <span>Records: 210</span>
                            <button class="btn-small" onclick="manageDataset('market')">
                                <i class="fas fa-edit"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="mt-30">
                    <h4>Dataset Operations</h4>
                    <div class="flex align-center gap-20 mt-20">
                        <button class="btn" onclick="importDataset()">
                            <i class="fas fa-file-import"></i>
                            Import Dataset
                        </button>
                        <button class="btn" onclick="exportDataset()">
                            <i class="fas fa-file-export"></i>
                            Export All Data
                        </button>
                        <button class="btn" onclick="backupDatabase()">
                            <i class="fas fa-database"></i>
                            Backup Database
                        </button>
                    </div>
                </div>
            </div>

            <!-- System Monitoring -->
            <div id="admin-system" class="card hidden mt-20">
                <div class="card-header">
                    <h3>System Monitoring</h3>
                    <div class="card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                
                <p class="mb-20" style="color: var(--text-light);">Monitor system performance, usage statistics, and server health.</p>
                
                <div class="grid cols-2">
                    <div>
                        <h4>System Status</h4>
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <strong>All systems operational</strong>
                                <div style="font-size: 0.9rem;">Last checked: Just now</div>
                            </div>
                        </div>
                        
                        <div class="mt-20">
                            <h4>Performance Metrics</h4>
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td>Response Time (Avg)</td>
                                        <td><span class="status success">1.2s</span></td>
                                    </tr>
                                    <tr>
                                        <td>Uptime</td>
                                        <td><span class="status success">99.8%</span></td>
                                    </tr>
                                    <tr>
                                        <td>Active Users</td>
                                        <td><span class="status info">127</span></td>
                                    </tr>
                                    <tr>
                                        <td>Recommendations Today</td>
                                        <td><span class="status info">42</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div>
                        <h4>System Logs</h4>
                        <div style="background: #f9f9f9; border-radius: var(--radius-sm); padding: 15px; max-height: 300px; overflow-y: auto;">
                            <div class="flex align-center justify-between mb-10" style="font-size: 0.85rem;">
                                <span><strong>Timestamp</strong></span>
                                <span><strong>Event</strong></span>
                            </div>
                            <div class="flex align-center justify-between mb-5" style="font-size: 0.8rem; padding: 8px 0; border-bottom: 1px solid #eee;">
                                <span>2025-10-15 10:23:15</span>
                                <span>User login: Ali Khan</span>
                            </div>
                            <div class="flex align-center justify-between mb-5" style="font-size: 0.8rem; padding: 8px 0; border-bottom: 1px solid #eee;">
                                <span>2025-10-15 10:15:42</span>
                                <span>Crop recommendation generated</span>
                            </div>
                            <div class="flex align-center justify-between mb-5" style="font-size: 0.8rem; padding: 8px 0; border-bottom: 1px solid #eee;">
                                <span>2025-10-15 09:58:33</span>
                                <span>Rule updated: Wheat_Rabi_Loamy</span>
                            </div>
                            <div class="flex align-center justify-between mb-5" style="font-size: 0.8rem; padding: 8px 0; border-bottom: 1px solid #eee;">
                                <span>2025-10-15 09:45:12</span>
                                <span>Database backup completed</span>
                            </div>
                            <div class="flex align-center justify-between mb-5" style="font-size: 0.8rem; padding: 8px 0; border-bottom: 1px solid #eee;">
                                <span>2025-10-15 09:30:05</span>
                                <span>System health check passed</span>
                            </div>
                        </div>
                        
                        <div class="mt-20">
                            <button class="btn w-100" onclick="viewFullLogs()">
                                <i class="fas fa-list"></i>
                                View Full Logs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <div class="footer">
            <p>Digital Agriculture Recommender System (DARS) - Software Engineering Project</p>
            <p>Sukkur IBA University | Department of Computer Science | December 2025</p>
            <p style="margin-top: 10px; font-size: 0.8rem; color: var(--text-light);">
                <i class="fas fa-exclamation-triangle"></i> 
                Disclaimer: This is a prototype system for academic purposes. Always consult with certified agricultural experts before making farming decisions.
            </p>
        </div>
    </main>
</div>

<script>
    // ========================
    // APPLICATION STATE
    // ========================
    let currentUser = {
        name: "",
        role: "",
        avatarColor: "#2E7D32"
    };
    
    let recommendations = [
        {id: 1, type: "crop", crop: "Wheat", date: "2025-10-14", match: 88, status: "Applied"},
        {id: 2, type: "crop", crop: "Mustard", date: "2025-09-21", match: 76, status: "Considered"},
        {id: 3, type: "soil", soilType: "Loamy", date: "2025-09-21", suitableCrops: ["Wheat", "Mustard", "Gram"]},
        {id: 4, type: "disease", crop: "Wheat", disease: "Yellow Rust", date: "2025-09-05", treatment: "Apply fungicide"},
        {id: 5, type: "forecast", season: "Kharif", region: "Punjab", date: "2025-08-18", crops: [{name: "Rice", demand: "High", trend: "Stable"}]}
    ];
    
    // ========================
    // FORM RESET FUNCTION
    // ========================
    function resetForms() {
        // Reset recommendation form
        document.getElementById('rec-form').reset();
        document.getElementById('rec-result').classList.add('hidden');
        document.getElementById('rec-list').innerHTML = '';
        
        // Reset soil form
        document.getElementById('soil-form').reset();
        document.getElementById('soil-result').classList.add('hidden');
        document.getElementById('suitable-list').innerHTML = '';
        
        // Reset disease form
        document.getElementById('disease-form').reset();
        document.getElementById('disease-result').classList.add('hidden');
        document.getElementById('diseaseres').innerHTML = '';
        
        // Reset forecast form
        document.getElementById('forecast-form').reset();
        document.getElementById('forecast-result').classList.add('hidden');
        document.querySelector('#forecast-table tbody').innerHTML = '';
        
        // Reset admin forms
        document.getElementById('crop-form').reset();
        document.getElementById('rule-form').reset();
        document.getElementById('rule-priority').value = 5;
        
        // Reset file inputs
        document.getElementById('photo').value = '';
        
        // Reset result sections
        document.querySelectorAll('.crop-recommendation').forEach(el => el.innerHTML = '');
        document.querySelectorAll('.alert').forEach(el => {
            if (el.id !== 'soil-advice') {
                el.style.display = 'flex';
            }
        });
    }
    
    // ========================
    // LOGIN / LOGOUT
    // ========================
    function login() {
        const name = document.getElementById("login-name").value.trim();
        const role = document.querySelector("input[name='role']:checked").value;
        
        if (!name) {
            alert("Please enter your name");
            return;
        }
        
        // Reset all forms before login
        resetForms();
        
        // Set user info
        currentUser.name = name;
        currentUser.role = role;
        currentUser.avatarColor = getAvatarColor(role);
        
        // Update UI
        document.getElementById("user-name").textContent = name;
        document.getElementById("user-role").textContent = role;
        document.getElementById("user-avatar").textContent = name.charAt(0).toUpperCase();
        document.getElementById("user-avatar").style.background = currentUser.avatarColor;
        
        // Hide login, show app
        document.getElementById("login-page").classList.add("hidden");
        document.getElementById("app-container").classList.remove("hidden");
        
        // Adjust admin access
        const adminNav = document.getElementById("nav-admin");
        const reportsNav = document.getElementById("nav-reports");
        const historyNav = document.getElementById("nav-history");
        
        if (role === "Farmer") {
            adminNav.style.display = "none";
            reportsNav.style.display = "flex";
            historyNav.style.display = "flex";
        } else if (role === "Admin" || role === "Agronomist") {
            adminNav.style.display = "flex";
            reportsNav.style.display = "flex";
            historyNav.style.display = "flex";
        }
        
        // Show dashboard
        show("dashboard");
        
        // Update dashboard stats
        updateDashboardStats();
    }
    
    function logout() {
        if (confirm("Are you sure you want to logout?")) {
            // Reset forms before logout
            resetForms();
            
            currentUser = { name: "", role: "", avatarColor: "#2E7D32" };
            document.getElementById("login-name").value = "";
            document.querySelector("input[name='role'][value='Farmer']").checked = true;
            
            document.getElementById("app-container").classList.add("hidden");
            document.getElementById("login-page").classList.remove("hidden");
        }
    }
    
    function getAvatarColor(role) {
        const colors = {
            "Farmer": "#4CAF50",
            "Admin": "#2196F3",
            "Agronomist": "#FF9800"
        };
        return colors[role] || "#2E7D32";
    }
    
    // ========================
    // VIEW MANAGEMENT
    // ========================
    const sections = ['dashboard', 'recommendForm', 'soilForm', 'disease', 'forecast', 'history', 'reports', 'admin'];
    
    function show(id) {
        // Hide all sections
        sections.forEach(s => document.getElementById(s).classList.add('hidden'));
        
        // Show selected section
        document.getElementById(id).classList.remove('hidden');
        
        // Update screen title
        const titles = {
            'dashboard': 'Dashboard',
            'recommendForm': 'Crop Recommendation',
            'soilForm': 'Soil Suitability Analysis',
            'disease': 'Disease Diagnosis',
            'forecast': 'Demand Forecast',
            'history': 'Recommendation History',
            'reports': 'Reports & Analytics',
            'admin': 'Administration Panel'
        };
        
        const subtitles = {
            'dashboard': 'Welcome to DARS - Your agricultural decision support system',
            'recommendForm': 'Get personalized crop recommendations based on your soil, season, and region',
            'soilForm': 'Check which crops are suitable for your soil type and conditions',
            'disease': 'Identify crop diseases and get treatment recommendations',
            'forecast': 'Get market demand predictions for upcoming seasons',
            'history': 'View your past recommendations and analyses',
            'reports': 'Generate reports and analyze your agricultural data',
            'admin': 'Manage system datasets, rules, users, and monitor system performance'
        };
        
        document.getElementById('screen-title').textContent = titles[id] || id;
        document.getElementById('screen-subtitle').textContent = subtitles[id] || '';
        
        // Update navigation highlighting
        document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
        const navButton = document.querySelector(`#nav-${id}`);
        if (navButton) navButton.classList.add('active');
        
        // Scroll to top
        document.querySelector('.main').scrollTop = 0;
    }
    
    // ========================
    // ADMIN TABS
    // ========================
    function showAdminTab(tab) {
        ['admin-crops', 'admin-rules', 'admin-users', 'admin-datasets', 'admin-system'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.classList.add('hidden');
        });
        
        const tabElement = document.getElementById(`admin-${tab}`);
        if (tabElement) tabElement.classList.remove('hidden');
    }
    
    // ========================
    // DASHBOARD FUNCTIONS
    // ========================
    function updateDashboardStats() {
        // In a real app, these would come from an API
        document.getElementById("stat-recommendations").textContent = recommendations.filter(r => r.type === "crop").length;
        document.getElementById("stat-soil-checks").textContent = recommendations.filter(r => r.type === "soil").length;
        document.getElementById("stat-disease-checks").textContent = recommendations.filter(r => r.type === "disease").length;
        document.getElementById("stat-forecasts").textContent = recommendations.filter(r => r.type === "forecast").length;
    }
    
    // ========================
    // CROP RECOMMENDATION
    // ========================
    function handleRecommend(e) {
        e.preventDefault();
        
        // Show loading
        document.getElementById('rec-loading').classList.remove('hidden');
        
        // Get form values
        const region = document.getElementById('region').value;
        const season = document.getElementById('season').value;
        const soilType = document.getElementById('soilType').value;
        const landArea = document.getElementById('landArea').value;
        const ph = document.getElementById('ph').value;
        const notes = document.getElementById('notes').value;
        
        // Validate
        if (!region || !season || !soilType || !landArea) {
            alert("Please fill in all required fields");
            document.getElementById('rec-loading').classList.add('hidden');
            return;
        }
        
        // Simulate API call delay
        setTimeout(() => {
            document.getElementById('rec-loading').classList.add('hidden');
            
            // Generate recommendations based on rules
            const recs = recommendMock(soilType, season, region, ph);
            
            // Display results
            const listContainer = document.getElementById('rec-list');
            listContainer.innerHTML = '';
            
            recs.forEach((rec, index) => {
                const cropCard = document.createElement('div');
                cropCard.className = 'crop-card';
                cropCard.innerHTML = `
                    <div class="crop-rank">${index + 1}</div>
                    <div class="crop-name">${rec.name}</div>
                    <div class="crop-match">${rec.match} Match</div>
                    <div class="crop-details">${rec.reason}</div>
                    <div class="crop-details">
                        <strong>Season:</strong> ${season}<br>
                        <strong>Soil:</strong> ${soilType}<br>
                        <strong>Region:</strong> ${region}
                    </div>
                    <div class="crop-actions">
                        <button class="btn btn-small" onclick="applyRecommendation('${rec.name}')">Apply</button>
                        <button class="btn-outline btn-small" onclick="saveForLater('${rec.name}')">Save</button>
                        <button class="btn-outline btn-small" onclick="getMoreInfo('${rec.name}')">Info</button>
                    </div>
                `;
                listContainer.appendChild(cropCard);
            });
            
            // Show results
            document.getElementById('rec-result').classList.remove('hidden');
            
            // Add to recent list
            addToRecentList(recs[0].name, recs[0].match);
            
            // Update stats
            updateDashboardStats();
            
            // Scroll to results
            document.getElementById('rec-result').scrollIntoView({ behavior: 'smooth' });
            
        }, 1500);
    }
    
    function recommendMock(soil, season, region, ph) {
        // Rule-based recommendation logic (simplified)
        const rules = [
            {
                name: 'Wheat',
                soil: ['Loamy', 'Clay'],
                season: ['Rabi'],
                region: ['Punjab', 'Sindh', 'Khyber Pakhtunkhwa'],
                pHMin: 6.0,
                pHMax: 7.5,
                match: '88%',
                reason: 'High market demand & excellent soil fit. Ideal for Rabi season in your region.'
            },
            {
                name: 'Mustard',
                soil: ['Loamy', 'Sandy'],
                season: ['Rabi'],
                region: ['Punjab', 'Sindh'],
                pHMin: 6.5,
                pHMax: 7.5,
                match: '76%',
                reason: 'Suitable for season and soil type. Good market price projected.'
            },
            {
                name: 'Barley',
                soil: ['Clay', 'Sandy'],
                season: ['Rabi', 'Kharif'],
                region: ['Punjab', 'Balochistan', 'Khyber Pakhtunkhwa'],
                pHMin: 6.0,
                pHMax: 8.0,
                match: '72%',
                reason: 'Tolerant to various soil conditions. Lower water requirement.'
            },
            {
                name: 'Rice',
                soil: ['Clay', 'Loamy'],
                season: ['Kharif'],
                region: ['Sindh', 'Punjab'],
                pHMin: 5.5,
                pHMax: 6.5,
                match: '65%',
                reason: 'Requires high water availability. Good fit for Kharif season.'
            },
            {
                name: 'Cotton',
                soil: ['Sandy', 'Loamy'],
                season: ['Kharif'],
                region: ['Punjab', 'Sindh'],
                pHMin: 5.8,
                pHMax: 8.0,
                match: '58%',
                reason: 'Requires warm climate and good irrigation. Long growing season.'
            }
        ];
        
        // Filter and score rules
        let filtered = rules.filter(rule => 
            rule.soil.includes(soil) && 
            rule.season.includes(season) && 
            rule.region.includes(region)
        );
        
        // If pH is provided, further filter by pH range
        if (ph) {
            const phNum = parseFloat(ph);
            filtered = filtered.filter(rule => 
                phNum >= rule.pHMin && phNum <= rule.pHMax
            );
        }
        
        // If no perfect matches, return top 3 from all rules
        if (filtered.length === 0) {
            filtered = rules.slice(0, 3);
        }
        
        // Sort by match percentage (descending)
        filtered.sort((a, b) => {
            const aMatch = parseInt(a.match);
            const bMatch = parseInt(b.match);
            return bMatch - aMatch;
        });
        
        // Return top 3
        return filtered.slice(0, 3);
    }
    
    function addToRecentList(crop, match) {
        const recentList = document.getElementById('recent-list');
        const newRow = document.createElement('tr');
        const today = new Date().toISOString().slice(0, 10);
        
        // Convert match string to number for status
        const matchNum = parseInt(match);
        let statusClass = 'warning';
        if (matchNum >= 85) statusClass = 'success';
        if (matchNum < 70) statusClass = 'danger';
        
        newRow.innerHTML = `
            <td>${crop}</td>
            <td>${today}</td>
            <td><span class="status ${statusClass}">${match}</span></td>
            <td>New</td>
        `;
        
        // Add to top of table
        if (recentList.firstChild) {
            recentList.insertBefore(newRow, recentList.firstChild);
        } else {
            recentList.appendChild(newRow);
        }
        
        // Limit to 5 rows
        while (recentList.children.length > 5) {
            recentList.removeChild(recentList.lastChild);
        }
        
        // Add to recommendations array
        recommendations.unshift({
            id: recommendations.length + 1,
            type: "crop",
            crop: crop,
            date: today,
            match: matchNum,
            status: "New"
        });
    }
    
    function applyRecommendation(cropName) {
        alert(`Applying recommendation: ${cropName}\n\nThis would connect to your farm management system in a real application.`);
        
        // Update status in recent list
        const rows = document.querySelectorAll('#recent-list tr');
        for (let row of rows) {
            if (row.cells[0].textContent === cropName) {
                row.cells[3].textContent = "Applied";
                break;
            }
        }
    }
    
    function saveForLater(cropName) {
        alert(`Saved ${cropName} for later consideration.\n\nYou can view saved items in your recommendation history.`);
    }
    
    function getMoreInfo(cropName) {
        alert(`Fetching detailed information for ${cropName}...\n\nIn a full implementation, this would show detailed crop information, growth requirements, and market data.`);
    }
    
    function saveRecommendation() {
        alert("Recommendation saved to your history.\n\nYou can access it anytime from the 'Recommendation History' section.");
    }
    
    function downloadRec() {
        const recList = document.getElementById('rec-list').innerText || 'No recommendation data';
        const blob = new Blob([`DARS Crop Recommendation\nGenerated on: ${new Date().toLocaleString()}\n\n${recList}\n\nDisclaimer: Always consult with certified agricultural experts before making farming decisions.`], {type:'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `DARS_Recommendation_${new Date().toISOString().slice(0,10)}.txt`;
        a.click();
        URL.revokeObjectURL(url);
        
        alert("Recommendation downloaded successfully!");
    }
    
    // ========================
    // SOIL ANALYSIS
    // ========================
    function handleSoil(e) {
        e.preventDefault();
        
        const soilType = document.getElementById('soilType2').value;
        const ph = document.getElementById('ph2').value;
        const n = document.getElementById('n').value;
        const p = document.getElementById('p').value;
        const k = document.getElementById('k').value;
        const moisture = document.getElementById('moisture').value;
        
        if (!soilType) {
            alert("Please select a soil type");
            return;
        }
        
        // Get suitable crops based on soil type
        const suitableCrops = getSuitableCrops(soilType, ph);
        
        // Display results
        const listContainer = document.getElementById('suitable-list');
        listContainer.innerHTML = '';
        
        suitableCrops.forEach((crop, index) => {
            const cropCard = document.createElement('div');
            cropCard.className = 'crop-card';
            cropCard.innerHTML = `
                <div class="crop-rank">${index + 1}</div>
                <div class="crop-name">${crop.name}</div>
                <div class="crop-match">${crop.suitability}</div>
                <div class="crop-details">${crop.description}</div>
                <div class="crop-details">
                    <strong>Soil:</strong> ${soilType}<br>
                    ${ph ? `<strong>pH:</strong> ${ph}<br>` : ''}
                    ${n ? `<strong>N:</strong> ${n} ppm<br>` : ''}
                    ${p ? `<strong>P:</strong> ${p} ppm<br>` : ''}
                    ${k ? `<strong>K:</strong> ${k} ppm` : ''}
                </div>
                <div class="crop-actions">
                    <button class="btn btn-small" onclick="show('recommendForm')">Get Recommendation</button>
                </div>
            `;
            listContainer.appendChild(cropCard);
        });
        
        // Provide soil advice
        const adviceElement = document.getElementById('soil-advice');
        let advice = getSoilAdvice(soilType, ph, n, p, k, moisture);
        adviceElement.innerHTML = `<i class="fas fa-lightbulb"></i><div>${advice}</div>`;
        
        // Show results
        document.getElementById('soil-result').classList.remove('hidden');
        
        // Add to recommendations
        recommendations.unshift({
            id: recommendations.length + 1,
            type: "soil",
            soilType: soilType,
            date: new Date().toISOString().slice(0,10),
            suitableCrops: suitableCrops.map(c => c.name)
        });
        
        // Update stats
        updateDashboardStats();
        
        // Scroll to results
        document.getElementById('soil-result').scrollIntoView({ behavior: 'smooth' });
    }
    
    function getSuitableCrops(soilType, ph) {
        // Soil-crop compatibility rules
        const compatibility = {
            'Loamy': [
                {name: 'Wheat', suitability: 'Excellent', description: 'Ideal for loamy soils with good drainage'},
                {name: 'Mustard', suitability: 'Very Good', description: 'Thrives in well-drained loamy soils'},
                {name: 'Gram', suitability: 'Good', description: 'Suitable for loamy soils with moderate fertility'},
                {name: 'Maize', suitability: 'Good', description: 'Prefers deep, well-drained loamy soils'}
            ],
            'Clay': [
                {name: 'Rice', suitability: 'Excellent', description: 'Clay retains water well for rice cultivation'},
                {name: 'Wheat', suitability: 'Good', description: 'Requires good drainage in clay soils'},
                {name: 'Barley', suitability: 'Very Good', description: 'Tolerant to heavy clay soils'}
            ],
            'Sandy': [
                {name: 'Cotton', suitability: 'Excellent', description: 'Prefers well-drained sandy soils'},
                {name: 'Millet', suitability: 'Very Good', description: 'Drought-tolerant, suitable for sandy soils'},
                {name: 'Groundnut', suitability: 'Good', description: 'Requires loose, sandy soil for pod development'}
            ],
            'Peaty': [
                {name: 'Rice', suitability: 'Excellent', description: 'Peaty soils retain moisture well'},
                {name: 'Vegetables', suitability: 'Good', description: 'Rich in organic matter, good for vegetables'}
            ],
            'Silty': [
                {name: 'Wheat', suitability: 'Very Good', description: 'Fertile silty soils are excellent for wheat'},
                {name: 'Rice', suitability: 'Good', description: 'Retains moisture well for rice cultivation'}
            ],
            'Chalky': [
                {name: 'Barley', suitability: 'Good', description: 'Tolerant to alkaline conditions'},
                {name: 'Mustard', suitability: 'Fair', description: 'Can grow in chalky soils with amendments'}
            ]
        };
        
        return compatibility[soilType] || [
            {name: 'Wheat', suitability: 'Good', description: 'Generally adaptable to various soil types'},
            {name: 'Barley', suitability: 'Good', description: 'Tolerant to a range of soil conditions'}
        ];
    }
    
    function getSoilAdvice(soilType, ph, n, p, k, moisture) {
        let advice = `Based on your soil type (${soilType}), `;
        
        if (soilType === 'Sandy') {
            advice += "we recommend adding organic matter like compost to improve water retention and nutrient holding capacity. ";
        } else if (soilType === 'Clay') {
            advice += "consider adding gypsum or organic matter to improve drainage and aeration. ";
        } else if (soilType === 'Loamy') {
            advice += "you have good soil structure. Maintain with regular organic amendments. ";
        }
        
        if (ph) {
            const pHNum = parseFloat(ph);
            if (pHNum < 6.0) {
                advice += "Your soil is acidic. Consider adding lime to raise pH. ";
            } else if (pHNum > 7.5) {
                advice += "Your soil is alkaline. Consider adding sulfur or organic matter to lower pH. ";
            } else {
                advice += "Your pH is in the optimal range for most crops. ";
            }
        }
        
        if (n && p && k) {
            const nNum = parseFloat(n), pNum = parseFloat(p), kNum = parseFloat(k);
            
            if (nNum < 20) advice += "Nitrogen levels are low. Consider nitrogen-rich fertilizers. ";
            if (pNum < 15) advice += "Phosphorus levels are low. Add phosphorus fertilizer. ";
            if (kNum < 150) advice += "Potassium levels are low. Consider potash fertilizer. ";
            
            if (nNum >= 20 && pNum >= 15 && kNum >= 150) {
                advice += "Nutrient levels appear adequate for most crops. ";
            }
        }
        
        advice += "Regular soil testing is recommended for precise fertilizer recommendations.";
        
        return advice;
    }
    
    // ========================
    // DISEASE DIAGNOSIS
    // ========================
    function handleDisease(e) {
        e.preventDefault();
        
        const crop = document.getElementById('dCrop').value;
        const symptoms = Array.from(document.querySelectorAll('input[name="sym"]:checked')).map(i => i.value);
        const symptomDesc = document.getElementById('symptom-desc').value;
        
        if (!crop) {
            alert("Please select a crop");
            return;
        }
        
        if (symptoms.length === 0 && !symptomDesc) {
            alert("Please select symptoms or describe the problem");
            return;
        }
        
        // Get diagnosis
        const diagnosis = diagnoseDisease(crop, symptoms, symptomDesc);
        
        // Display results
        const resultContainer = document.getElementById('diseaseres');
        resultContainer.innerHTML = `
            <div class="grid cols-2">
                <div>
                    <h4>Diagnosis</h4>
                    <div class="alert ${diagnosis.confidence === 'High' ? 'alert-warning' : 'alert-info'}">
                        <i class="fas fa-diagnoses"></i>
                        <div>
                            <strong>${diagnosis.disease}</strong>
                            <div style="font-size: 0.9rem;">Confidence: ${diagnosis.confidence}</div>
                        </div>
                    </div>
                    <p><strong>Symptoms matched:</strong> ${diagnosis.matchedSymptoms.join(', ')}</p>
                    <p><strong>Description:</strong> ${diagnosis.description}</p>
                </div>
                <div>
                    <h4>Recommended Treatment</h4>
                    <div class="alert alert-success">
                        <i class="fas fa-prescription-bottle-alt"></i>
                        <div>${diagnosis.treatment}</div>
                    </div>
                    <p><strong>Application:</strong> ${diagnosis.application}</p>
                    <p><strong>Prevention:</strong> ${diagnosis.prevention}</p>
                </div>
            </div>
        `;
        
        // Show results
        document.getElementById('disease-result').classList.remove('hidden');
        
        // Add to recommendations
        recommendations.unshift({
            id: recommendations.length + 1,
            type: "disease",
            crop: crop,
            disease: diagnosis.disease,
            date: new Date().toISOString().slice(0,10),
            treatment: diagnosis.treatment
        });
        
        // Update stats
        updateDashboardStats();
        
        // Scroll to results
        document.getElementById('disease-result').scrollIntoView({ behavior: 'smooth' });
    }
    
    function diagnoseDisease(crop, symptoms, description) {
        // Disease knowledge base (simplified)
        const diseaseDB = {
            'Wheat': [
                {
                    disease: 'Yellow Rust',
                    symptoms: ['yellow', 'brown'],
                    description: 'Yellow to orange pustules on leaves, reducing photosynthesis.',
                    treatment: 'Apply fungicide containing tebuconazole or propiconazole.',
                    application: 'Apply twice at 15-day intervals. Ensure complete coverage.',
                    prevention: 'Use resistant varieties, avoid excessive nitrogen, practice crop rotation.',
                    confidence: 'High'
                },
                {
                    disease: 'Powdery Mildew',
                    symptoms: ['powder', 'yellow'],
                    description: 'White powdery growth on leaves and stems.',
                    treatment: 'Apply sulfur-based fungicide or potassium bicarbonate.',
                    application: 'Apply at first sign of disease and repeat as needed.',
                    prevention: 'Ensure good air circulation, avoid dense planting.',
                    confidence: 'High'
                }
            ],
            'Rice': [
                {
                    disease: 'Bacterial Blight',
                    symptoms: ['yellow', 'wilting'],
                    description: 'Yellow to white stripes on leaves, wilting of seedlings.',
                    treatment: 'Apply streptomycin or copper-based bactericides.',
                    application: 'Apply early in disease development.',
                    prevention: 'Use disease-free seeds, avoid excessive nitrogen.',
                    confidence: 'Medium'
                }
            ],
            'Mustard': [
                {
                    disease: 'White Rust',
                    symptoms: ['powder', 'yellow'],
                    description: 'White pustules on leaves and inflorescence.',
                    treatment: 'Apply metalaxyl or mancozeb fungicides.',
                    application: 'Apply at first symptoms and repeat after 15 days.',
                    prevention: 'Use resistant varieties, practice crop rotation.',
                    confidence: 'High'
                }
            ],
            'Cotton': [
                {
                    disease: 'Leaf Curl Virus',
                    symptoms: ['yellow', 'stunted'],
                    description: 'Upward curling of leaves, vein thickening, stunted growth.',
                    treatment: 'No direct treatment. Remove and destroy infected plants.',
                    application: 'N/A',
                    prevention: 'Control whitefly vectors, use resistant varieties.',
                    confidence: 'High'
                }
            ]
        };
        
        // Default if no specific match
        const defaultDiagnosis = {
            disease: 'General Fungal Infection',
            symptoms: symptoms,
            description: 'Based on symptoms, a general fungal infection is likely.',
            treatment: 'Apply broad-spectrum fungicide following manufacturer instructions.',
            application: 'Apply as directed on product label.',
            prevention: 'Improve air circulation, avoid overhead watering, practice crop rotation.',
            confidence: 'Low',
            matchedSymptoms: symptoms
        };
        
        // Try to find match
        const cropDiseases = diseaseDB[crop] || [];
        let bestMatch = null;
        let maxMatches = 0;
        
        for (let disease of cropDiseases) {
            const matched = disease.symptoms.filter(s => symptoms.includes(s)).length;
            if (matched > maxMatches) {
                maxMatches = matched;
                bestMatch = disease;
            }
        }
        
        if (bestMatch && maxMatches >= 1) {
            bestMatch.matchedSymptoms = bestMatch.symptoms.filter(s => symptoms.includes(s));
            return bestMatch;
        }
        
        // If description contains keywords
        const desc = description.toLowerCase();
        if (desc.includes('rust')) {
            defaultDiagnosis.disease = 'Rust Disease';
            defaultDiagnosis.treatment = 'Apply fungicide specific for rust diseases.';
            defaultDiagnosis.confidence = 'Medium';
        } else if (desc.includes('spot') || desc.includes('blight')) {
            defaultDiagnosis.disease = 'Leaf Spot/Blight';
            defaultDiagnosis.treatment = 'Apply chlorothalonil or mancozeb fungicide.';
            defaultDiagnosis.confidence = 'Medium';
        }
        
        return defaultDiagnosis;
    }
    
    // ========================
    // DEMAND FORECAST
    // ========================
    function handleForecast(e) {
        e.preventDefault();
        
        const season = document.getElementById('fSeason').value;
        const region = document.getElementById('fRegion').value;
        const year = document.getElementById('fYear').value;
        
        if (!season || !region) {
            alert("Please select season and region");
            return;
        }
        
        // Get forecast data
        const forecastData = getDemandForecast(season, region, year);
        
        // Display results
        const tableBody = document.querySelector('#forecast-table tbody');
        tableBody.innerHTML = '';
        
        forecastData.forEach(item => {
            const row = document.createElement('tr');
            
            let trendClass = 'info';
            if (item.trend === 'Rising') trendClass = 'success';
            if (item.trend === 'Declining') trendClass = 'danger';
            
            let demandClass = 'info';
            if (item.demand === 'High') demandClass = 'success';
            if (item.demand === 'Low') demandClass = 'warning';
            
            row.innerHTML = `
                <td>${item.crop}</td>
                <td><span class="status ${demandClass}">${item.demand}</span></td>
                <td><span class="status ${trendClass}">${item.trend}</span></td>
                <td>${item.price}</td>
                <td>${item.recommendation}</td>
            `;
            tableBody.appendChild(row);
        });
        
        // Show results
        document.getElementById('forecast-result').classList.remove('hidden');
        
        // Add to recommendations
        recommendations.unshift({
            id: recommendations.length + 1,
            type: "forecast",
            season: season,
            region: region,
            year: year,
            date: new Date().toISOString().slice(0,10),
            crops: forecastData
        });
        
        // Update stats
        updateDashboardStats();
        
        // Scroll to results
        document.getElementById('forecast-result').scrollIntoView({ behavior: 'smooth' });
    }
    
    function getDemandForecast(season, region, year) {
        // Mock forecast data based on season and region
        const forecasts = {
            'Rabi': {
                'Punjab': [
                    {crop: 'Wheat', demand: 'High', trend: 'Rising', price: 'PKR 3,500/40kg', recommendation: 'Strongly Recommended'},
                    {crop: 'Mustard', demand: 'Medium', trend: 'Stable', price: 'PKR 8,200/40kg', recommendation: 'Recommended'},
                    {crop: 'Gram', demand: 'Medium', trend: 'Rising', price: 'PKR 12,000/40kg', recommendation: 'Good Option'},
                    {crop: 'Barley', demand: 'Low', trend: 'Stable', price: 'PKR 2,800/40kg', recommendation: 'Consider if suitable'}
                ],
                'Sindh': [
                    {crop: 'Wheat', demand: 'Medium', trend: 'Stable', price: 'PKR 3,400/40kg', recommendation: 'Recommended'},
                    {crop: 'Mustard', demand: 'Low', trend: 'Declining', price: 'PKR 7,800/40kg', recommendation: 'Consider alternatives'},
                    {crop: 'Vegetables', demand: 'High', trend: 'Rising', price: 'Varies', recommendation: 'Good for local markets'}
                ]
            },
            'Kharif': {
                'Punjab': [
                    {crop: 'Rice', demand: 'High', trend: 'Rising', price: 'PKR 4,200/40kg', recommendation: 'Strongly Recommended'},
                    {crop: 'Cotton', demand: 'Medium', trend: 'Stable', price: 'PKR 8,500/40kg', recommendation: 'Recommended'},
                    {crop: 'Maize', demand: 'High', trend: 'Rising', price: 'PKR 3,000/40kg', recommendation: 'Good Option'},
                    {crop: 'Sugarcane', demand: 'Medium', trend: 'Declining', price: 'PKR 200/40kg', recommendation: 'Contract farming recommended'}
                ],
                'Sindh': [
                    {crop: 'Rice', demand: 'High', trend: 'Rising', price: 'PKR 4,000/40kg', recommendation: 'Strongly Recommended'},
                    {crop: 'Cotton', demand: 'High', trend: 'Rising', price: 'PKR 8,800/40kg', recommendation: 'Excellent Choice'},
                    {crop: 'Sugarcane', demand: 'High', trend: 'Stable', price: 'PKR 210/40kg', recommendation: 'Recommended'}
                ]
            },
            'Zaid': {
                'Punjab': [
                    {crop: 'Vegetables', demand: 'High', trend: 'Rising', price: 'Varies', recommendation: 'Good for quick returns'},
                    {crop: 'Pulses', demand: 'Medium', trend: 'Stable', price: 'PKR 10,000/40kg', recommendation: 'Consider for soil health'}
                ],
                'Sindh': [
                    {crop: 'Vegetables', demand: 'High', trend: 'Rising', price: 'Varies', recommendation: 'Good for local markets'},
                    {crop: 'Fodder', demand: 'Medium', trend: 'Stable', price: 'PKR 1,500/40kg', recommendation: 'For livestock integration'}
                ]
            }
        };
        
        return forecasts[season]?.[region] || [
            {crop: 'Wheat', demand: 'Medium', trend: 'Stable', price: 'PKR 3,400/40kg', recommendation: 'Generally reliable'},
            {crop: 'Rice', demand: 'Medium', trend: 'Stable', price: 'PKR 4,000/40kg', recommendation: 'Stable market'},
            {crop: 'Vegetables', demand: 'High', trend: 'Rising', price: 'Varies', recommendation: 'Good for diversification'}
        ];
    }
    
    // ========================
    // HISTORY MANAGEMENT
    // ========================
    function filterHistory(type) {
        const buttons = document.querySelectorAll('#history .btn-small');
        buttons.forEach(btn => {
            if (btn.textContent.includes(type) || type === 'all') {
                btn.classList.remove('btn-outline');
                btn.classList.add('active');
            } else {
                btn.classList.add('btn-outline');
                btn.classList.remove('active');
            }
        });
        
        // In a real app, this would filter the table
        alert(`Filtering history by: ${type}\n\nIn a full implementation, this would filter the history table.`);
    }
    
    function viewHistoryItem(id) {
        const item = recommendations.find(r => r.id === id);
        if (!item) {
            alert("History item not found");
            return;
        }
        
        let message = `History Item #${id}\n`;
        message += `Type: ${item.type}\n`;
        message += `Date: ${item.date}\n\n`;
        
        if (item.type === 'crop') {
            message += `Crop: ${item.crop}\n`;
            message += `Match: ${item.match}%\n`;
            message += `Status: ${item.status}`;
        } else if (item.type === 'soil') {
            message += `Soil Type: ${item.soilType}\n`;
            message += `Suitable Crops: ${item.suitableCrops.join(', ')}`;
        } else if (item.type === 'disease') {
            message += `Crop: ${item.crop}\n`;
            message += `Disease: ${item.disease}\n`;
            message += `Treatment: ${item.treatment}`;
        } else if (item.type === 'forecast') {
            message += `Season: ${item.season}\n`;
            message += `Region: ${item.region}\n`;
            message += `Year: ${item.year}`;
        }
        
        alert(message);
    }
    
    function downloadHistoryItem(id) {
        alert(`Downloading history item #${id}\n\nIn a full implementation, this would download a detailed report.`);
    }
    
    function exportAllHistory() {
        const historyData = JSON.stringify(recommendations, null, 2);
        const blob = new Blob([`DARS History Export\nExported on: ${new Date().toLocaleString()}\n\n${historyData}`], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `DARS_History_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        alert("All history exported successfully!");
    }
    
    // ========================
    // REPORTS & ANALYTICS
    // ========================
    function generateReport(type) {
        const reportNames = {
            'crop': 'Crop Recommendation Report',
            'soil': 'Soil Analysis Summary Report',
            'disease': 'Disease Diagnosis Report'
        };
        
        alert(`Generating ${reportNames[type]}...\n\nIn a full implementation, this would generate a PDF report with charts and analysis.`);
        
        // Simulate report generation
        setTimeout(() => {
            alert(`${reportNames[type]} generated successfully!\n\nThe report would be available for download in a full implementation.`);
        }, 1000);
    }
    
    function generateComprehensiveReport() {
        alert("Generating comprehensive report...\n\nThis would create a complete PDF report including all your agricultural data, recommendations, and analytics.");
        
        // Simulate report generation
        setTimeout(() => {
            alert("Comprehensive report generated successfully!\n\nIn a full implementation, you would be able to download the PDF report.");
        }, 1500);
    }
    
    // ========================
    // ADMIN FUNCTIONS
    // ========================
    function handleCropSave(e) {
        e.preventDefault();
        
        const name = document.getElementById('crop-name').value;
        const soil = document.getElementById('crop-soil').value;
        const season = document.getElementById('crop-season').value;
        const nut = document.getElementById('crop-nut').value;
        const desc = document.getElementById('crop-desc').value;
        
        if (!name) {
            alert("Please enter a crop name");
            return;
        }
        
        // Add to table
        const table = document.getElementById('crop-table').querySelector('tbody');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>${name}</td>
            <td>${soil || '-'}</td>
            <td>${season || '-'}</td>
            <td>${nut || '-'}</td>
            <td>
                <button class="btn-small btn-outline" onclick="editCrop(this)">Edit</button>
                <button class="btn-small" onclick="deleteCrop(this)">Delete</button>
            </td>
        `;
        table.appendChild(newRow);
        
        alert(`Crop "${name}" added successfully!`);
        e.target.reset();
    }
    
    function resetCropForm() {
        document.getElementById('crop-form').reset();
    }
    
    function editCrop(button) {
        const row = button.closest('tr');
        const cells = row.cells;
        
        document.getElementById('crop-name').value = cells[0].textContent;
        document.getElementById('crop-soil').value = cells[1].textContent !== '-' ? cells[1].textContent : '';
        document.getElementById('crop-season').value = cells[2].textContent !== '-' ? cells[2].textContent : '';
        document.getElementById('crop-nut').value = cells[3].textContent !== '-' ? cells[3].textContent : '';
        
        alert("Editing crop. Update values and click 'Save Crop' to save changes.");
    }
    
    function deleteCrop(button) {
        if (confirm("Are you sure you want to delete this crop?")) {
            const row = button.closest('tr');
            row.remove();
            alert("Crop deleted successfully!");
        }
    }
    
    function handleRuleSave(e) {
        e.preventDefault();
        
        const category = document.getElementById('rule-category').value;
        const name = document.getElementById('rule-name').value;
        const condition = document.getElementById('rule-condition').value;
        const action = document.getElementById('rule-action').value;
        const priority = document.getElementById('rule-priority').value;
        
        if (!condition || !action) {
            alert("Please enter both condition and action");
            return;
        }
        
        // Add to table
        const table = document.querySelector('#rule-list');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>${category.charAt(0).toUpperCase() + category.slice(1)}</td>
            <td>${name || 'Unnamed Rule'}</td>
            <td>${condition}</td>
            <td>${action}</td>
            <td>${priority}</td>
            <td>
                <button class="btn-small btn-outline" onclick="editRule(this)">Edit</button>
                <button class="btn-small" onclick="deleteRule(this)">Delete</button>
            </td>
        `;
        table.appendChild(newRow);
        
        alert(`Rule saved successfully!`);
        e.target.reset();
        document.getElementById('rule-priority').value = 5;
    }
    
    function resetRuleForm() {
        document.getElementById('rule-form').reset();
        document.getElementById('rule-priority').value = 5;
    }
    
    function testRule() {
        const condition = document.getElementById('rule-condition').value;
        const action = document.getElementById('rule-action').value;
        
        if (!condition || !action) {
            alert("Please enter a rule to test");
            return;
        }
        
        alert(`Testing rule:\n\nIF ${condition}\nTHEN ${action}\n\nIn a full implementation, this would test the rule against sample data.`);
    }
    
    function editRule(button) {
        const row = button.closest('tr');
        const cells = row.cells;
        
        // Set category
        const category = cells[0].textContent.toLowerCase();
        document.getElementById('rule-category').value = category;
        
        document.getElementById('rule-name').value = cells[1].textContent !== 'Unnamed Rule' ? cells[1].textContent : '';
        document.getElementById('rule-condition').value = cells[2].textContent;
        document.getElementById('rule-action').value = cells[3].textContent;
        document.getElementById('rule-priority').value = cells[4].textContent;
        
        alert("Editing rule. Update values and click 'Save Rule' to save changes.");
    }
    
    function deleteRule(button) {
        if (confirm("Are you sure you want to delete this rule?")) {
            const row = button.closest('tr');
            row.remove();
            alert("Rule deleted successfully!");
        }
    }
    
    function addNewUser() {
        alert("Add New User functionality\n\nIn a full implementation, this would open a form to add a new user with email, role, and permissions.");
    }
    
    function editUser(id) {
        alert(`Editing user #${id}\n\nIn a full implementation, this would open the user editor with current user data.`);
    }
    
    function toggleUserStatus(id) {
        if (confirm("Are you sure you want to change this user's status?")) {
            alert(`User status toggled for user #${id}\n\nIn a full implementation, this would activate/deactivate the user account.`);
        }
    }
    
    function manageDataset(dataset) {
        alert(`Managing ${dataset} dataset\n\nIn a full implementation, this would open a detailed dataset management interface.`);
    }
    
    function importDataset() {
        alert("Import Dataset functionality\n\nIn a full implementation, this would allow uploading CSV/Excel files to update system datasets.");
    }
    
    function exportDataset() {
        alert("Exporting all datasets...\n\nIn a full implementation, this would download all system datasets as a zip file.");
        
        // Simulate export
        setTimeout(() => {
            alert("All datasets exported successfully!");
        }, 1000);
    }
    
    function backupDatabase() {
        alert("Creating database backup...\n\nIn a full implementation, this would create a complete backup of the system database.");
        
        // Simulate backup
        setTimeout(() => {
            alert("Database backup completed successfully!\n\nBackup saved to server.");
        }, 1500);
    }
    
    function viewFullLogs() {
        alert("Viewing full system logs\n\nIn a full implementation, this would show a paginated view of all system logs with filtering options.");
    }
    
    // ========================
    // INITIALIZATION
    // ========================
    document.addEventListener('DOMContentLoaded', function() {
        // Set current year in forecast form
        document.getElementById('fYear').value = new Date().getFullYear();
        
        // Initialize dashboard stats
        updateDashboardStats();
    });
</script>
</body>
</html>